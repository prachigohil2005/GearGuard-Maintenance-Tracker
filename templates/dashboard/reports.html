{% extends "base.html" %}

{% block title %}Reports - GearGuard{% endblock %}

{% block extra_css %}
<style>
.reports-container {
    padding: 2rem;
}

.report-controls {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* FIXED ALIGNMENT CSS */
.report-controls form {
    display: flex;
    gap: 1.5rem;
    align-items: flex-end; /* Ensures button bottom aligns with select box bottom */
    flex-wrap: wrap;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 0; /* Remove default margins to keep alignment tight */
}

.form-group label {
    font-weight: 600;
    color: #495057;
    font-size: 0.9rem;
}

.report-summary {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.summary-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    text-align: center;
}

.summary-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #0d6efd;
    margin-bottom: 0.5rem;
}

.summary-label {
    color: #6c757d;
    font-size: 0.875rem;
}

.team-reports {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.report-table {
    width: 100%;
    margin-top: 1.5rem;
    border-collapse: collapse;
}

.report-table th {
    background: #f8f9fa;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
}

.report-table td {
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
}

.report-table tr:hover {
    background: #f8f9fa;
}

.print-section {
    margin-top: 2rem;
    text-align: right;
}

@media print {
    .sidebar, .header-actions, .report-controls, .print-section {
        display: none !important;
    }
    
    .main-content {
        margin-left: 0 !important;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="reports-container">
    <div class="page-header mb-4">
        <h1>üìà Monthly Reports</h1>
    </div>
    
    <div class="report-controls">
        <form method="GET">
            <div class="form-group">
                <label for="month">Month</label>
                <select name="month" id="month" class="form-control" style="min-width: 150px;">
                    {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if m == month %}selected{% endif %}>
                        {{ ['January', 'February', 'March', 'April', 'May', 'June', 
                            'July', 'August', 'September', 'October', 'November', 'December'][m-1] }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="year">Year</label>
                <select name="year" id="year" class="form-control" style="min-width: 120px;">
                    {% for y in range(2023, 2027) %}
                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary px-4">Generate Report</button>
        </form>
    </div>
    
    <div class="report-summary">
        <div class="summary-card">
            <div class="summary-value">{{ total_requests }}</div>
            <div class="summary-label">Total Requests</div>
        </div>
        
        <div class="summary-card">
            <div class="summary-value">{{ completed_requests }}</div>
            <div class="summary-label">Completed</div>
        </div>
        
        <div class="summary-card">
            <div class="summary-value">{{ "%.1f"|format(total_duration) }}</div>
            <div class="summary-label">Total Hours</div>
        </div>
    </div>
    
    <div class="team-reports">
        <h2 class="mb-3">Team Performance</h2>
        <table class="report-table">
            <thead>
                <tr>
                    <th>Team Name</th>
                    <th>Total Requests</th>
                    <th>Completed</th>
                    <th>Completion Rate</th>
                    <th>Total Hours</th>
                    <th>Avg Hours/Request</th>
                </tr>
            </thead>
            <tbody>
                {% for report in team_reports %}
                <tr>
                    <td><strong>{{ report.team_name }}</strong></td>
                    <td>{{ report.total_requests }}</td>
                    <td>{{ report.completed }}</td>
                    <td>
                        {% if report.total_requests > 0 %}
                        <span class="badge bg-info text-dark">
                            {{ "%.1f"|format((report.completed / report.total_requests) * 100) }}%
                        </span>
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>{{ "%.1f"|format(report.total_hours) }} hrs</td>
                    <td>
                        {% if report.completed > 0 %}
                        {{ "%.1f"|format(report.total_hours / report.completed) }} hrs
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="print-section">
        <button onclick="window.print()" class="btn btn-outline-secondary">
            <i class="fas fa-print"></i> üñ®Ô∏è Print Report
        </button>
    </div>
</div>
{% endblock %}